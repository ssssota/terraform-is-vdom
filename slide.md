---
marp: true
---

# Terraformは仮想DOM

~ Terraformと仮想DOMを同時に理解する ~

**TOMIKAWA Sotaro**

---

## 自己紹介

**冨川宗太郎**

2022年新卒WEAR Webフロントエンド（テックリード）

#times-tomikawa に生息

---

## どちらかを知っている人向けの雑すぎる解説

|Terraform|仮想DOM|
|---|---|
|HCL|JSX|
|Plan|Diffing|
|tfstate|Virtual DOM|
|Apply|Commit|

---

## なにいっとんねんしばくぞ

* Terraformはインフラを宣言的に管理する
* 仮想DOMはUIを宣言的に管理する

どちらも宣言的に何かを管理するもの

---

## 管理とは

インフラもUIも何かしらの要因で変化する

* インフラ: サーバー増えたり、インスタンス変えたり
* UI: ユーザーが操作したり、APIからデータが来たり

管理とは、「変化を適用する」こと（だけではないが一旦着目）

---

## 宣言に則って変化を適用することは難しい

インフラもUIも Scrap & Build で変化を適用できない

* インフラ: サーバーは動いているし、DBにはデータがある
* UI: ユーザーの入力や状態があるし、チラツキが発生する

---

## じゃあどうするか

変更箇所を特定して、変更箇所だけを適用する

---

## 変更箇所を特定するのは難しい

正確にはコストが高すぎる

インフラもUIも、現在の状態を取得するのは時間がかかりすぎる

---

## じゃあどうするか

現在のインフラ/UIの状態を仮想的に保持しておく

* インフラ(Terraform): tfstate
* UI: Virtual DOM

新しい設計図と仮想状態を比較して、変更箇所を特定する

---

## つまり

|設計図|→|仮想状態|→|実状態|
|---|---|---|---|---|
|HCL|Plan|tfstate|Apply|インフラ|
|JSX|Diffing|Virtual DOM|Commit|UI|

---

## まとめ

宣言的に管理するためには、仮想状態（中間表現）を持つといい感じになる

Terraformも仮想DOMも、宣言的に管理するために仮想状態を持ち、差分を洗い出して、最適な変更を適用する
